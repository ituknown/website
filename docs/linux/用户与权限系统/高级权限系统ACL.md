## å‰è¨€

ACL çš„å…¨ç§°æ˜¯ **file access control lists**ã€‚ç®€å•ç²—æš´ç‚¹è¯´å°±æ˜¯æ–‡ä»¶çº§åˆ«çš„è®¿é—®æ§åˆ¶æƒé™ï¼Œåœ¨å…·ä½“è¯´æ˜ä»‹ç»ä¹‹å‰å…ˆæ¥è€ƒè™‘ä¸€ä¸‹ä¸ºä»€ä¹ˆéœ€è¦ ACLï¼Ÿ

ç°åœ¨æœ‰ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶å±æ€§å¦‚ä¸‹ï¼š

```
-rwxrwxr-- 1 webuser example 0 Dec 11 20:54 readme
```

å¯¹åº”çš„æ–‡ä»¶æƒé™ä¸ºï¼š

| **ç”¨æˆ·** | **æƒé™**     |
| :------- | :----------- |
| æ‰€å±è€…   | è¯»ã€å†™ã€æ‰§è¡Œ |
| æ‰€å±ç»„   | è¯»ã€å†™ã€æ‰§è¡Œ |
| å…¶ä»–ç”¨æˆ· | è¯»           |


é—®é¢˜æ¥ç€ï¼Œæˆ‘ç°åœ¨æƒ³è®©è¿™ â€œå…¶ä»–ç”¨æˆ·â€ ä¸­çš„æŸä¸ªç”¨æˆ·ä¹Ÿå…·æœ‰å†™çš„æƒé™è¯¥æ€ä¹ˆåŠï¼Ÿæ˜¾ç„¶ï¼Œå•å­˜çš„è¿˜ä½¿ç”¨ä¼ ç»Ÿçš„ç”¨æˆ·ã€ç»„ã€å…¶ä»–ç”¨æˆ·å»æ§åˆ¶æ˜¯æ— æ³•å®ç°çš„ï¼Œè¿™å°±éœ€è¦ä½¿ç”¨ ACL äº†ã€‚

ACL èƒ½å¤ŸæŠ›å¼€ä¼ ç»Ÿçš„æƒé™ä¹‹å¤–è¿˜èƒ½å¤Ÿæ›´ç»†ç²’åº¦çš„æ§åˆ¶æŸä¸ªäººå¯¹è¯¥æ–‡ä»¶çš„è¯»å†™æƒé™ï¼Œæ¯”å¦‚æƒ³è®©è¿™ â€œå…¶ä»–ç”¨æˆ·â€ ä¸­çš„æŸä¸ªç”¨æˆ·å…·æœ‰å†™çš„æƒé™ã€‚åŒæ—¶å‘¢ï¼Œè¿˜èƒ½å»æ§åˆ¶å¦ä¸€ä¸ª â€œå…¶ä»–ç”¨æˆ·â€ æœ‰æ‰§è¡Œçš„æƒé™ã€‚

æ‰€ä»¥ï¼Œå½“ä½ æœ‰éœ€è¦æ§åˆ¶ç”¨æˆ·çº§åˆ«çš„æƒé™çš„è¯ï¼Œå°±éœ€è¦ ACL äº†ã€‚

ACL æœ‰å¦ä¸¤ä¸ªå‘½ä»¤ï¼Œåˆ†åˆ«ä½¿ç”¨æˆ·æŸ¥çœ‹ ACL çš„æƒé™å‘½ä»¤ `getfacl` ä»¥åŠè®¾ç½® ACL æƒé™çš„ `setfacl` å‘½ä»¤ï¼Œä¸‹é¢æ¥åˆ†åˆ«çœ‹ä¸‹ï¼š

## getfacl å‘½ä»¤è¯­æ³•è¯´æ˜

`getfacl` å‘½ä»¤æ˜¯ç”¨äºæŸ¥çœ‹æ–‡ä»¶çš„ ACL æƒé™ï¼Œå‘½ä»¤æ¯”è¾ƒç®€å•ï¼š

```bash
$ getfacl [file|dir]
```

æ¯”å¦‚åˆšæ‰çš„ readme æ–‡ä»¶ï¼š

```bash
$ getfacl readme
```

è¾“å‡ºå¦‚ä¸‹ï¼š

```
# file: readme
# owner: webuser
# group: example
user::rw-
group::rw-
other::r--
```

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¾“å‡ºçš„ä¿¡æ¯ä¸­ä¼šè¯¦ç»†çš„å±•ç¤ºè¯¥æ–‡ä»¶çš„æƒé™ä¿¡æ¯ã€‚æ–‡ä»¶åæ˜¯ `readme`ã€æ–‡ä»¶çš„æ‰€å±è€…æ˜¯ `webuser`ã€æ‰€å±ç»„æ˜¯ `example`ï¼ŒåŒæ—¶ä¼šåœ¨ä¸‹é¢æ˜¾ç¤ºå…·ä½“çš„æ–‡ä»¶æƒé™ä¿¡æ¯ã€‚

æœ‰è¶£çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨ RHEL/CentOS ç³»ç»Ÿä¸­è¯¥æ–‡ä»¶çš„å±æ€§æ˜¾ç¤ºå¦‚ä¸‹ï¼š

```
-rwxrwxr--. 1 webuser webuser 0 Dec 11 20:53 readme
          -
          |
          +------> æ³¨æ„è¿™é‡Œ
```

æ³¨æ„çœ‹åœ¨æƒé™åé¢æœ‰ä¸ª `.`ï¼Œè¡¨ç¤ºè¯¥æ–‡ä»¶æ²¡æœ‰è®¾ç½® ACL æƒé™ï¼Œå¦‚æœè®¾ç½® ACL çš„è¯è¿™é‡Œä¼šæ˜¯ä¸€ä¸ª `+`ã€‚æ˜¯ä¸æ˜¯å¾ˆå‹å¥½ï¼Ÿ

## setfacl å‘½ä»¤è¯­æ³•è¯´æ˜

`setfacl` è®¾ç½® ACL æƒé™å‘½ä»¤å°±æ¯”è¾ƒå¤æ‚äº†ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š

```
setfacl [-bdR] [{-m|-x} acl_perms] [file|dir]...
```

**å‚æ•°è¯´æ˜ï¼š**

```
-b: åˆ é™¤æ‰€æœ‰ ACL æƒé™, æ¢å¤ä¸ºé»˜è®¤æƒé™
-d: è®¾ç½®ä¸ºé»˜è®¤æƒé™
-R: é€’å½’æ‰§è¡Œ, ç”¨äºæ–‡ä»¶å¤¹

-m: ä¿®æ”¹ACLæƒé™æ“ä½œ
-x: åˆ é™¤ACLæƒé™æ“ä½œ
```

acl_perms åˆ™æ˜¯é‡ç‚¹ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š

```bash
# è®¾ç½®æ–‡ä»¶æœ‰æ•ˆæƒé™
[d[efault]:] m[ask][:] [:rwx]

# è®¾ç½®ç”¨æˆ·çº§åˆ«æƒé™
[d[efault]:] [u[ser]:]uid [:rwx]

# è®¾ç½®ç»„çº§åˆ«æƒé™
[d[efault]:] g[roup]:gid [:rwx]

# è®¾ç½®å…¶ä»–ç”¨æˆ·æƒé™
[d[efault]:] o[ther][:] [:rwx]
```

$1.$ `default,d` ä¸æ–‡ä»¶å¤¹æœ‰å…³ï¼Œå°±æ˜¯ç»§æ‰¿çš„æ„æ€ã€‚æ¯”å¦‚åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè®¾ç½® ACL ä¸º `rw`ã€‚ä½†æ˜¯è¿™ä¸ª `rw` ä»…ä»…æ˜¯é’ˆå¯¹è¯¥æ–‡ä»¶å¤¹ï¼Œå¦‚æœä½ åœ¨æ–‡ä»¶å¤¹ä¸‹é¢å†åˆ›å»ºä¸€ä¸ªæ–‡ä»¶çš„è¯ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªæ–°çš„æ–‡ä»¶æ²¡æœ‰ `rw` æƒé™ã€‚

å› ä¸ºï¼Œå¦‚æœä½ æƒ³è®©æ–‡ä»¶å¤¹ä¸‹çš„æ–°åˆ›å»ºçš„å­æ–‡ä»¶è‡ªåŠ¨ç»§æ‰¿ acl æƒé™çš„è¯å°±éœ€è¦ä½¿ç”¨ `default` å‚æ•°ã€‚

$2.$ `mask,m` åˆ™æ˜¯æ–‡ä»¶çš„æœ‰æ•ˆæƒé™ã€‚æ¯”å¦‚ä½ å°†æŸä¸ªç”¨æˆ·è®¾ç½®çš„æ“ä½œæƒé™æ˜¯ `rwx`ï¼Œä½†æ˜¯è¯¥æ–‡ä»¶çš„æœ€å¤§æƒé™å´æ˜¯ `rx`ã€‚é‚£ä¹ˆè¯¥ç”¨æˆ·å®é™…æœ‰æ•ˆæƒé™ä¸ä¼šæ˜¯ `rwx`ï¼Œè€Œæ˜¯ `rx`ã€‚æ„æ€å°±æ˜¯ç”¨æˆ·çš„æ“ä½œæƒé™ä¸æ–‡ä»¶çš„æœ‰æ•ˆæƒé™å–äº¤é›†ã€‚

$3.$ `user,u` æ˜¯æŒ‡å®šçš„å…·ä½“ç”¨æˆ·ï¼Œå¯ä»¥æ˜¯ç”¨æˆ·åï¼Œä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·çš„ IDã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š

```plaintext
# ç»™å•ä¸€ç”¨æˆ·è®¾ç½®æƒé™
user:u1:perms

# ç»™é€šè¿‡ç”¨æˆ·è®¾ç½®æƒé™
user:u1,u2,u3:perms
```

|**æ³¨æ„**|
|:------|
|`u1`ã€`u2` å¯ä»¥æ˜¯å…·ä½“çš„ç”¨æˆ·åï¼Œä¹Ÿå¯ä»¥æ˜¯ UIDã€‚ |

**4ï¼‰** `group,g` æŒ‡å®šå…·ä½“çš„ç»„ï¼Œå¯ä»¥æ˜¯ç»„çš„åç§°ä¹Ÿå¯ä»¥æ˜¯ IDã€‚ç¤ºä¾‹ï¼š

```
group:g1:perms
group:g1,g2,g3:perms
```

|**æ³¨æ„**|
|:------|
|`g1`ã€`g2` å¯ä»¥æ˜¯å…·ä½“çš„ç»„åï¼Œä¹Ÿå¯ä»¥æ˜¯ GIDã€‚ |

**5ï¼‰** `other,o` å°±æ˜¯å…¶ä»–ç”¨æˆ·äº†ï¼Œæ²¡å•¥å¥½è¯´çš„ï¼Œå®é™…ä¸Šè°ä¼šä½¿ç”¨ ACL å»è®¾ç½®å…¶ä»–ç”¨æˆ·çš„æƒé™å‘¢ï¼Ÿ

**6ï¼‰** `rwx` å°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„æƒé™å€¼ã€‚


## ACL ç‰›åˆ€å°è¯•

ç°åœ¨æˆ‘ä»¬æ¥æ¼”ç¤ºä¸€ä¸ªç®€å•çš„æ —å­ï¼Œå¦‚ä¸‹ï¼š

```bash
# åˆ›å»ºæ–‡ä»¶
$ touch readme

# ä¿®æ”¹æ‰€å±ç”¨äºä»¥åŠæ‰€å±ç»„
$ sudo chown webuser:example readme

# æŸ¥çœ‹æ–‡ä»¶å±æ€§ä¿¡æ¯
$ ls -l
total 0
-rw-r--r-- 1 webuser example 0 Dec 11 21:57 readme
```

ç»§ç»­åˆ›å»ºä¸€ä¸ªç”¨æˆ· `acluser`ï¼š

```bash
$ sudo useradd -m -s /usr/bin/bash acluser
```

ç°åœ¨æˆ‘æƒ³è®©è¿™ä¸ª `acluser` å¯¹è¯¥æ–‡ä»¶æœ‰è¯»å†™æƒé™ï¼Œacl å‘½ä»¤å¦‚ä¸‹ï¼š

```bash
$ sudo setfacl -m u:acluser:rw readme
# æˆ–
$ sudo setfacl -m user:acluser:rw readme
```

å†æ¥çœ‹ä¸‹æ–‡ä»¶å±æ€§ä¿¡æ¯ï¼š

```bash
$ ls -l
total 0
-rw-rw-r--+ 1 webuser example 0 Dec 11 21:57 readme
          -
          |
          +-------> æ³¨æ„è¿™é‡Œ
```

æ³¨æ„çœ‹åœ¨æƒé™åé¢æœ‰ä¸ª `+`ï¼Œè¿™å°±è¡¨ç¤ºæœ‰ ACL æƒé™ã€‚æ¥çœ‹ä¸‹æƒé™ä¿¡æ¯ï¼š

```bash
$ getfacl readme
```

è¾“å‡ºå¦‚ä¸‹ï¼š

```bash
# file: readme
# owner: webuser
# group: example
user::rw-
user:acluser:rw-  ## <== æ³¨æ„è¿™é‡Œ
group::r--
mask::rw-
other::r--
```

æ³¨æ„çœ‹åœ¨è¾“å‡ºçš„ä¿¡æ¯ä¸­å¤šäº†ä¸€ä¸ªç”¨æˆ· `acluser`ï¼ŒåŒæ—¶æƒé™æ˜¯ `rw`ã€‚æ€ä¹ˆæ ·ï¼Œç°åœ¨æ˜¯ä¸æ˜¯å°±ç†è§£æ€ä¹ˆå›äº‹äº†ï¼Ÿ

å†æ¥ç»™ç”¨æˆ· `kali` è®¾ç½®ä¸ºæ‰§è¡Œæƒé™ï¼š

```bash
$ sudo setfacl -m u:kali:x readme
```

æ¥çœ‹ä¸‹ ACL ä¿¡æ¯ï¼š

```bash
$ getfacl readme

# file: readme
# owner: webuser
# group: example
user::rw-
user:acluser:rw-
user:kali:--x     # <== åˆå¤šäº†ä¸€ä¸ª kali
group::r--
mask::rwx
other::r--
```

æœ€åï¼Œæˆ‘æƒ³åˆ é™¤ç”¨æˆ· `acluser` çš„ ACL æƒé™ï¼š

```bash
# ä½¿ç”¨ -x å‚æ•°åˆ é™¤, ä¸éœ€è¦åŠ æƒé™å€¼
$ sudo setfacl -x user:acluser: readme

# æŸ¥çœ‹ ACL æƒé™ä¿¡æ¯
$ getfacl readme

# file: readme
# owner: webuser
# group: example
user::rw-
user:kali:--x  # <== åªæœ‰ kali è¿™ä¸ªç”¨æˆ·, æ²¡æœ‰ acluser
group::r--
mask::r-x
other::r--
```

éœ€è¦ç‰¹åˆ«å¼ºè°ƒäº†æ˜¯ï¼ŒACL æ›´å¤šçš„æ˜¯é’ˆå¯¹éæ–‡ä»¶æ‰€å±è€…ä»¥åŠæ‰€å±ç»„ï¼Œé’ˆå¯¹çš„æ˜¯ â€œå…¶ä»–ç”¨æˆ·â€ è¿™éƒ¨åˆ†äººã€‚

## ç»™ç”¨æˆ·è®¾ç½® ACL æƒé™

ç»™ç”¨æˆ·è®¾ç½®æƒé™çš„è¯­æ³•å¦‚ä¸‹ï¼š

```bash
setfacl -m u[ser]:[users...]:[rwx] [file|dir]...
```

`-m` æ˜¯ modify çš„æ„æ€ï¼Œä½œç”¨æ˜¯è®¾ç½®æˆ–ä¿®æ”¹ ACLã€‚

`user` ä¸èƒ½çœç•¥ï¼ˆå¯ä»¥ç›´æ¥ä½¿ç”¨ç¼©å†™ `u`ï¼‰ï¼Œç”¨äºæŒ‡å®šæ˜¯ç»™ç”¨æˆ·è®¾ç½® ACL æƒé™ã€‚ä¹‹åéœ€è¦è·Ÿå…·ä½“çš„ç”¨æˆ·ï¼ˆå¯ä»¥æ˜¯ç”¨æˆ·åä¹Ÿå¯ä»¥æ˜¯å…·ä½“çš„ UIDï¼‰ã€‚ç‰¹åˆ«å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯ï¼Œå¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªç”¨æˆ·ï¼Œå¤šä¸ªç”¨æˆ·ä¹‹é—´ä½¿ç”¨ `","` åˆ†éš”ã€‚ä¹‹åå°±è·Ÿå…·ä½“çš„æƒé™å€¼ `rwx` å³å¯ã€‚

æœ€åå‘¢ï¼ŒæŒ‡å®šå…·ä½“çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªã€‚

ä¸‹é¢çœ‹ä¸‹ç¤ºä¾‹ï¼š

$1.$ ç»™ç”¨æˆ· `webuser` è®¾ç½®è¯»å†™æƒé™ï¼š

```bash
$ sudo setfacl -m user:webuser:rw file
```

$2.$ ä¿®æ”¹ `webuser` çš„æƒé™ä¸ºåªè¯»ï¼š

```bash
$ sudo setfacl -m user:webuser:r file
```

$3.$ åŒæ—¶ç»™å¤šä¸ªç”¨æˆ·è®¾ç½®è¯»å†™æƒé™ï¼š

```bash
$ sudo setfacl -m user:example1,example2:rwx
```

### ACL æƒé™ç»§æ‰¿ï¼ˆæ–‡ä»¶å¤¹ï¼‰

è¯­æ³•å¦‚ä¸‹ï¼š

```bash
setfacl -m [d[efault]:]u[ser]:[users...]:[rwx] [file|dir]...
```

ä¸ä¹‹å‰çš„ç¤ºä¾‹çš„åŒºåˆ«æ˜¯ï¼Œå¤šäº†ä¸€ä¸ª `default`ï¼ˆå¯ä»¥ç›´æ¥ä½¿ç”¨ç¼©å†™ `d`ï¼‰ï¼Œè¿™ä¸ªæ˜¯é’ˆå¯¹æ–‡ä»¶å¤¹çš„åŠŸèƒ½ã€‚

æˆ‘ä»¬ç°åœ¨çœ‹ä¸‹æ²¡æœ‰å‚æ•° `default` çš„æƒ…å†µï¼š

```bash
# åˆ›å»ºæ–‡ä»¶ä»¶
$ mkdir dir

# ç»™æ–‡ä»¶å¤¹è®¾ç½® ACL æƒé™
$ sudo setfacl -m user:webuser:rw dir
```

æŸ¥çœ‹ ACL æƒé™ï¼š

```bash
$ getfacl dir/

# file: dir/
# owner: kali
# group: kali
user::rwx
user:webuser:rw-
group::rwx
mask::rwx
other::r-x
```

æ¥ç€åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š

```bash
$ touch dir/readme
```

çœ‹ä¸‹å­æ–‡ä»¶çš„ ACLï¼š

```bash
$ getfacl dir/readme

# file: dir/readme
# owner: kali
# group: kali
user::rw-
group::rw-
other::r--
```

å¾ˆæ˜æ˜¾ï¼Œå­æ–‡ä»¶æ²¡æœ‰ç»§æ‰¿ ACL æƒé™ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å°±éœ€è¦ `default` å‚æ•°äº†ï¼š

```bash
# å…ˆåˆ é™¤æ–‡ä»¶å¤¹çš„ ACL æƒé™
$ sudo setfacl -b dir
```

ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ `default` å‚æ•°è®¾ç½® ACL æƒé™ï¼š

```bash
# ä½¿ç”¨ default ä½¿æƒé™ç»§æ‰¿
$ sudo setfacl -m d:user:webuser:rw dir

# åˆ›å»ºå­æ–‡ä»¶
$ touch dir/readme1

## æŸ¥çœ‹å­æ–‡ä»¶ ACL
$ getfacl dir/readme1
# file: dir/readme1
# owner: kali
# group: kali
user::rw-
user:webuser:rw-    # <== ç»§æ‰¿æ–‡ä»¶å¤¹ ACL æƒé™
group::rwx			#effective:rw-
mask::rw-
other::r--
```

éœ€è¦å¼ºè°ƒäº†ä¸€ç‚¹æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰çš„å­æ–‡ä»¶éƒ½ä¼šç»§æ‰¿ ACLã€‚æ¯”å¦‚ä¸‹é¢ï¼š

```bash
$ sudo setfacl -m d:user:webuser:rw dir
$ sudo setfacl -m user:kali:rw dir
```

|**æ³¨æ„**|
|:------|
|ç”±äºåœ¨ç»™ `kali` ç”¨æˆ·è®¾ç½® ACL æƒé™æ˜¯æ²¡æœ‰ä½¿ç”¨ `default`ï¼Œæ‰€ä»¥å­æ–‡ä»¶ç»§æ‰¿çš„ ACL åªä¼šåŒ…å« `webuser`ã€‚ä½†æ˜¯ç»™ç”¨æˆ· `kali` è®¾ç½® ACL æƒé™æ—¶æ²¡æœ‰æŒ‡å®š `default` è¿›è¡Œæƒé™ç»§æ‰¿ï¼Œæ‰€ä»¥å­æ–‡ä»¶ä¸­å°±ä¸åŒ…å«è¯¥ç”¨æˆ·çš„ ACL æƒé™å€¼ï¼Œè¿™ä¸ªéœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚|

## ç»™ç”¨æˆ·ç»„è®¾ç½® ACL æƒé™

è¿™ä¸ªä¸ç”¨æˆ·ä¸€è‡´ï¼Œç»™å‚æ•° `user` æ¢æˆ `group` å³å¯ï¼š

```bash
setfacl -m g[roup]:[groups...]:[rwx] [file|dir]...
setfacl -m [d[efault]:]g[roup]:[groups...]:[rwx] [file|dir]...
```

ç›´æ¥çœ‹ä¸‹ç¤ºä¾‹å³å¯ï¼ˆä¸è®¾ç½®ç”¨æˆ·ä¸€è‡´ï¼‰ï¼š

$1.$ ç»™ç»„ `sshd` è®¾ç½®è¯»å†™æƒé™ï¼š

```bash
$ sudo setfacl -m group:sshd:rw file
```

$2.$ ä¿®æ”¹ç»„ `sshd` çš„æƒé™ä¸ºåªè¯»ï¼š

```bash
$ sudo setfacl -m group:sshd:r file
```

$3.$ åŒæ—¶ç»™å¤šä¸ªç»„è®¾ç½®è¯»å†™æƒé™ï¼š

```bash
$ sudo setfacl -m group:example1,sshd:r file
```

$4.$ ACL æƒé™ç»§æ‰¿ï¼ˆæ–‡ä»¶å¤¹ï¼‰:

```bash
$ sudo setfacl -m d:group:sshd:rwx file
```

## é€’å½’è®¾ç½®å­æ–‡ä»¶

è¿™ä¸ªè¿˜æ˜¯æŒºé‡è¦çš„ï¼Œå‰é¢è¯´çš„ [ACL æƒé™ç»§æ‰¿ï¼ˆæ–‡ä»¶å¤¹ï¼‰](#acl-æƒé™ç»§æ‰¿æ–‡ä»¶å¤¹) é’ˆå¯¹çš„æ˜¯åœ¨æ–‡ä»¶å¤¹ä¸­åˆ›å»ºçš„æ–°æ–‡ä»¶ï¼Œä¸è¿‡å¦‚æœæ–‡ä»¶å¤¹åŸæœ¬å°±æœ‰æ–‡ä»¶è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬ç»™æ–‡ä»¶å¤¹è®¾ç½® ACL æƒé™æ—¶å¹¶ä¸ä¼šé’ˆå¯¹æ–‡ä»¶å¤¹ä¸­å·²å­˜åœ¨çš„æ–‡ä»¶ã€‚å¦‚æœæƒ³è¦ç»™å­æ–‡ä»¶ä¹Ÿè®¾ç½® ACL å°±éœ€è¦ä½¿ç”¨é€’å½’å‘½ä»¤äº†ï¼Œå¦‚ä¸‹ï¼š

```bash
$ setfacl -R -m [d[efault]:]u[ser]:[rwx] [file|dir]...
$ setfacl -R -m [d[efault]:]g[group]:[rwx] [file|dir]...
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿˜æ˜¯ç»™ç”¨æˆ·æˆ–ç»„è®¾ç½® ACL æƒé™æ˜¯åŠ ä¸Šå‚æ•° `-R` å³å¯ã€‚

ç°åœ¨æ¥ç»™ä¸€ä¸ªæ–°ç”¨æˆ· `erha` é’ˆå¯¹æ–‡ä»¶å¤¹ `dir` è®¾ç½®ä¸‹ ACL æƒé™ï¼š

```bash
$ setfacl -R -m user:erha:rwx dir/
```

æ¥çœ‹ä¸‹ä¹‹å‰æ–‡ä»¶å¤¹ä¸­çš„ readme æ–‡ä»¶æœ‰æ²¡æœ‰è¢«é€’å½’è®¾ç½®ï¼š

```bash
$ getfacl dir/readme

# file: dir/readme
# owner: kali
# group: kali
user::rw-
user:erha:rwx   # <== åœ¨è¿™å‘¢
group::rw-
mask::rwx
other::r--
```

## æœ‰æ•ˆæƒé™ mask

è¿™ä¸ªå°±ç‰¹é‡è¦äº†ï¼Œä¹‹å‰ç»™ç”¨æˆ·å’Œç»„è®¾ç½®çš„æƒé™éƒ½ä¸è¿™ä¸ªæœ‰æ•ˆæƒé™æœ‰å…³ã€‚æ¯”å¦‚å¦‚æœæ–‡ä»¶çš„æœ‰æ•ˆæƒé™æ˜¯ `rw`ï¼Œä½†æ˜¯ä½ ç»™ç”¨æˆ·è®¾ç½®çš„æƒé™æ˜¯ `rx`ï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·å®é™…èƒ½ä½¿ç”¨çš„æƒé™åªä¼šæœ‰ `r`ã€‚å°±æ˜¯è¯´ï¼Œç”¨æˆ·çš„å®é™…æƒé™æ˜¯è®¾ç½®çš„æƒé™ä¸æ–‡ä»¶çš„æœ‰æ•ˆæƒé™å–1äº¤é›†ã€‚

æœ‰æ•ˆæƒé™è¯­æ³•å¦‚ä¸‹ï¼š

```bash
setfacl -m [d[efault]:]m[ask]:[rwx]
```

è¿˜æ˜¯ä»¥ä¸Šé¢åˆ›å»ºçš„æ–‡ä»¶å¤¹ `dir` ä¸ºä¾‹ï¼Œå°†æƒé™è®¾ç½®ä¸ºåªè¯»ï¼ˆåŒæ—¶æŒ‡å®š ACL æƒé™ç»§æ‰¿ï¼‰ï¼š

```bash
$ setfacl -m d:mask:r dir
```

æ¥çœ‹ä¸‹æ–‡ä»¶å¤¹ ACL ä¿¡æ¯ï¼š

```bash
$ getfacl dir/

# file: dir/
# owner: kali
# group: kali
user::rwx
group::rwx
other::r-x
default:user::rwx
default:user:webuser:rw-	#effective:r--
default:group::rwx		#effective:r--
default:mask::r--
default:other::r-x
```

æ³¨æ„çœ‹è¾“å‡ºï¼š

```bash
default:user:webuser:rw-	#effective:r--
default:group::rwx		#effective:r--
default:mask::r--
```

`mask` æ˜¯æˆ‘ä»¬è®¾ç½®çš„æœ‰æ•ˆæƒé™ï¼Œæƒé™å€¼ä¸º `r`ã€‚ç»“æœä¹‹å‰è®¾ç½®çš„ç”¨æˆ· `webuser` å’Œç»„çš„æœ‰æ•ˆæƒé™ä¹Ÿå˜æˆäº†åªè¯»ï¼ˆ`effective:r--`ï¼‰ã€‚åŒæ—¶è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œè®¾ç½®çš„ ACL å¹¶ä¸ä¼šå½±å“åˆ°è¯¥æ–‡ä»¶çš„æ‰€å±è€…ä»¥åŠæ‰€å±ç»„ï¼Œå¯ä»¥çœ‹ä¸‹ä¸Šé¢çš„è¾“å‡ºä¿¡æ¯ã€‚

æ‰€ä»¥å‘¢ï¼Œæˆ‘ä»¬ä¸ºäº†å®é™…ä½¿ç”¨æ–¹ä¾¿ä¼šå°†æœ‰æ•ˆæƒé™è®¾ç½®åˆ°æœ€å¤§ï¼š`rwx`ã€‚å½“ç„¶äº†é¢ï¼Œè¿˜ç®—æ˜¯å› äººè€Œå¼‚å‘¢~


## åˆ é™¤ ACL æƒé™

æ—¢ç„¶ä¼šè®¾ç½®è‚¯å®šå°±ä¼šæœ‰åˆ é™¤ï¼Œåˆ é™¤åªéœ€è¦ç»™ä¹‹å‰çš„å‚æ•° `-m` æ›¿æ¢ä¸º `-x`ï¼ŒåŒæ—¶ä¸è¦æŒ‡å®šæƒé™å€¼å³å¯ã€‚è¯­æ³•å¦‚ä¸‹ï¼š

```bash
setfacl [-R] -x [d[efault]:]u[ser] file...
setfacl [-R] -x [d[efault]:]g[roup] file...
```

æ¯”å¦‚åˆ é™¤æ–‡ä»¶å¤¹ dir ä¸Šçš„ç”¨æˆ· webuser çš„ ACL æƒé™ï¼š

```bash
$ setfacl -R -x d:user:webuser dir
```

## æ¸…ç©º ACL æƒé™

ä¸åˆ é™¤ä¸ä¸€æ ·ï¼Œåˆ é™¤æ˜¯åªé’ˆå¯¹ç”¨æˆ·æˆ–ç»„ã€‚è€Œæ¸…ç©ºåˆ™æ˜¯é’ˆå¯¹å…·ä½“çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼Œä¸€æ¬¡æ€§å°†æŒ‡å®šæ–‡ä»¶çš„ ACL å…¨éƒ¨åˆ é™¤ã€‚è¯­æ³•å¦‚ä¸‹ï¼š

```bash
setfacl [-R] -b [file|dir]...
```

æ¯”å¦‚æ¸…ç©ºæ–‡ä»¶å¤¹ dir ä»¥åŠå­æ–‡ä»¶è®¾ç½®çš„æ‰€æœ‰ ACL æƒé™ï¼š

```bash
$ setfacl -R -b dir
```

## å‚è€ƒé“¾æ¥

https://linux.die.net/man/1/setfacl
https://www.ibm.com/docs/en/zos/2.4.0?topic=scd-setfacl-set-remove-change-access-control-lists-acls

--

å®Œç»“ï¼Œæ’’èŠ±ğŸ‰ğŸ‰ğŸ‰~